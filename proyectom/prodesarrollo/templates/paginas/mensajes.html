{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mensajes - {{ request.user.username }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css?family=Grand+Hotel&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'myapp/css/inicio.css' %}">
        <style>
        body {
            background-color: black;
            color: white;
        }
        .sidebar-icon {
            width: 24px;
            height: 24px;
        }
        .story-ring {
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
        }
    </style>
</head>
<body class="bg-black text-white font-sans">
    <div class="flex">
        <nav class="fixed h-screen w-[72px] overflow-x-hidden transition-all duration-300 border-r border-zinc-800 px-1 py-1 flex flex-col items-center bg-black z-50">            
            <div class="py-4 mb-4 mt-2">
                <img src="{% static 'myapp/img/instagram.png' %}" alt="instagram" class="w-6 h-6 mb-4 mt-2">
            </div>
            
            <a href="{% url 'inicio' %}" class="flex justify-center w-full px-3 py-3 rounded-lg hover:bg-zinc-800 mt-3">
                <svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M9.005 16.545a2.997 2.997 0 012.997-2.997h0A2.997 2.997 0 0115 16.545V22h7V11.543L12 2 2 11.543V22h7.005z"/></svg>
                <span class="hidden">Inicio</span>
            </a>

            <a href="#" class="flex justify-center w-full px-3 py-3 rounded-lg hover:bg-zinc-800 mt-3">
                <svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M19 10.5A8.5 8.5 0 1110.5 2a8.5 8.5 0 018.5 8.5z"/><path fill="none" stroke="currentColor" d="M16.511 16.511L22 22"/></svg>
                <span class="hidden">Buscar</span>
            </a>

            <a href="#" class="flex justify-center w-full px-3 py-3 rounded-lg hover:bg-zinc-800 mt-3">
                <svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0z"/></svg>
                <span class="hidden">Explorar</span>
            </a>

            <a href="#" class="flex justify-center w-full px-3 py-3 rounded-lg hover:bg-zinc-800 mt-3">
                <svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0z"/></svg>
                <span class="hidden">Reels</span>
            </a>

            <a href="{% url 'mensajes' %}" class="flex justify-center w-full gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2 mt-3">
                <svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12.003 2.001a9.705 9.705 0 110 19.4 10.876 10.876 0 01-2.895-.384.798.798 0 00-.533.04l-1.984.876a.801.801 0 01-1.123-.708l-.054-1.78a.806.806 0 00-.27-.569 9.49 9.49 0 01-3.14-7.175 9.65 9.65 0 0110-9.7z" stroke="currentColor" strokeMiterlimit="10"/></svg>
                <span class="hidden">Mensajes</span>
            </a>

            <a href="#" class="flex justify-center w-full items-center gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2 mt-3">
                <svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M16.792 3.904A4.989 4.989 0 0121.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 014.708-5.218 4.21 4.21 0 013.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 013.679-1.938m0-2a6.04 6.04 0 00-4.797 2.127 6.052 6.052 0 00-4.787-2.127A6.985 6.985 0 00.5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 003.518 3.018 2 2 0 002.174 0 45.263 45.263 0 003.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 00-6.708-7.218z"/></svg>
                <span class="hidden">Notificaciones</span>
            </a>

            <div class="w-[72px] relative inline-block text-left">
            <a onclick="toggleMenu()" class="flex justify-center w-full items-center gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2 mt-3">
                <img src="{% static 'myapp/img/mas.png' %}" alt="crear" class="w-6 h-6 mr-4 justi">
                <span class="hidden">Crear</span>
            </a>

                <div id="dropdownMenu" class="hidden absolute w-full origin-top-right rounded-md bg-neutral-800 text-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none">
                    <button id="abrirModal" class="flex w-full items-center gap-2 px-4 py-4 rounded-md hover:bg-neutral-700">Publicaci칩n
                    <img src="{% static 'myapp/img/camara.png' %}" alt="publi" class="w-8 h-8 ml-[45%]">
                    </button>
                    <a href="#" class="flex items-center gap-2 px-4 py-4 rounded-md hover:bg-neutral-700">
                    Historia
                    <img src="{% static 'myapp/img/historia.png' %}" alt="historia" class="w-6 h-6 ml-[60%]">
                    </a>
                    <a href="#" class="flex items-center gap-2 px-4 py-4 rounded-md hover:bg-neutral-700">
                    Anuncio
                    <img src="{% static 'myapp/img/anuncio.png' %}" alt="anuncio" class="w-6 h-6 ml-[58%]">
                    </a>
                    <a href="#" class="flex items-center gap-2 px-4 py-4 rounded-md hover:bg-neutral-700">
                    IA
                    <img src="{% static 'myapp/img/ai.png' %}" alt="ai" class="w-6 h-6 ml-[80%]">
                    </a>
                </div>
            </div>

            <a href="{% url 'perfil' user.username %}" class="flex justify-center w-full items-center gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2 mt-3">
                <img src="{{ sugerencia.usuario.profile.avatar.url|default:'/media/perfiles/perfil_default.jpg' }}" alt="Perfil" class="w-6 h-6 rounded-full justify-center">
                <span class="hidden">Perfil</span>
            </a>
            
            <a href="https://www.meta.ai/" class="flex justify-center w-full items-center gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2 mt-[110%]">
            <img src="{% static 'myapp/img/ai.png' %}" alt="ai" class="w-6 h-6">
            <span class="hidden">Meta AI</span>
            </a>

            <div class="w-[240px] relative inline-block text-left">
                <button onclick="Menumas()" class="flex justify-center w-full items-center gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2 mt-3">
                <img src="{% static 'myapp/img/menu.png' %}" alt="crear" class="w-6 h-6 mr-4">
                <span class="hidden">M치s</span>
                </button>

                <div id="MasMenu" class="hidden absolute bottom-full w-full origin-top-right rounded-md bg-neutral-800 text-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none">
                    <a href="{% url 'editar_perfil' %}" class="flex w-full items-center gap-2 px-4 py-4 rounded-md hover:bg-neutral-700">Configuraci칩n
                    <img src="{% static 'myapp/img/confi.png' %}" alt="publi" class="w-7 h-7 ml-[35%]">
                    </a>
                    <a href="#" class="flex items-center gap-2 px-4 py-2 rounded-md hover:bg-neutral-700 mb-2">
                    Cambiar apariencia
                    <img src="{% static 'myapp/img/apariencia.png' %}" alt="historia" class="w-7 h-7 ml-[48%]">
                    </a>
                    <div class="border-t-4 border-b-2 border-neutral-700 mb-2 py-2">
                        <a href="#" class="flex items-center gap-2 px-4 py-4 rounded-md hover:bg-neutral-700">
                        Cambiar cuenta
                        <img src="{% static 'myapp/img/cambiar.png' %}" alt="anuncio" class="w-6 h-6 ml-[30%] rounded-full">
                        </a>
                    </div>
                    <a href="{% url 'cerrarse' %}" class="flex items-center gap-2 px-4 py-4 rounded-md hover:bg-neutral-700">
                    Salir
                    <img src="{% static 'myapp/img/salir.png' %}" alt="ai" class="w-7 h-7 ml-[67%]">
                    </a>
                </div>
            </div>
        </nav>

    <main class="flex-1 flex h-screen overflow-hidden">

        <div class="w-[350px] border-r border-zinc-800 overflow-y-auto">
            <div class="p-4 border-b border-zinc-800 text-xl font-semibold">Mensajes</div>
            <ul>
                <!-- Ejemplo de conversaci칩n -->
                <li class="hover:bg-zinc-800 cursor-pointer px-4 py-3 flex items-center gap-3">
                    <img src="https://via.placeholder.com/40" alt="perfil" class="rounded-full w-10 h-10">
                    <div>
                        <div class="font-semibold">emma_myers</div>
                        <div class="text-zinc-400 text-sm">Hello 游때</div>
                    </div>
                </li>
                <!-- Puedes replicar m치s conversaciones aqu칤 -->
            </ul>
        </div>

        <!-- 츼rea de chat -->
        <div class="flex-1 flex flex-col">
            <!-- Header del chat -->
            <div class="flex items-center gap-3 border-b border-zinc-800 px-6 py-4">
                <img src="https://via.placeholder.com/32" alt="perfil" class="rounded-full w-8 h-8">
                <h2 class="font-semibold text-lg">{{ receiver.username }}</h2>
            </div>

            <!-- Chat log -->
            <div id="chat-log" class="flex-1 overflow-y-auto p-6 space-y-3">
                <!-- Mensajes aparecer치n aqu칤 -->
            </div>

            <!-- Input de mensaje -->
            <div class="border-t border-zinc-800 p-4 flex items-center gap-3">
                <input id="chat-message-input" type="text" placeholder="Escribe un mensaje..."
                    class="flex-1 bg-zinc-900 text-white border border-zinc-700 rounded-full px-4 py-2 focus:outline-none">
                <button id="chat-message-submit"
                    class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-full font-semibold">Enviar</button>
            </div>
        </div>
    </main>
</div>

<!-- Script WebSocket -->
<script>
    const userUsername = "{{ request.user.username }}";
    const receiverUsername = "{{ receiver.username }}";
    const chatSocket = new WebSocket(`ws://${window.location.host}/ws/chat/${receiverUsername}/`);

    const chatLog = document.getElementById("chat-log");
    const chatInput = document.getElementById("chat-message-input");
    const chatSubmit = document.getElementById("chat-message-submit");

    chatSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        const message = data.message;
        const sender = data.sender;
        const isSelf = sender === userUsername;

        const messageDiv = document.createElement("div");
        messageDiv.classList.add("max-w-[70%]", "px-4", "py-2", "rounded-lg", "inline-block");
        messageDiv.classList.add(isSelf ? "bg-blue-500 self-end ml-auto text-white" : "bg-zinc-700 text-white");

        messageDiv.textContent = `${message}`;
        chatLog.appendChild(messageDiv);
        chatLog.scrollTop = chatLog.scrollHeight;
    };

    chatSubmit.onclick = function() {
        const message = chatInput.value;
        if (message.trim() !== "") {
            chatSocket.send(JSON.stringify({
                message: message,
                receiver: receiverUsername
            }));
            chatInput.value = "";
        }
    };

    chatInput.addEventListener("keyup", function(e) {
        if (e.key === "Enter") {
            chatSubmit.click();
        }
    });
</script>

<script src="{% static 'myapp/js/inicio.js' %}"></script>

</body>
</html>
