{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css?family=Grand+Hotel&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'myapp/css/inicio.css' %}">
    <style>
        body {
            background-color: black;
            color: white;
        }
        .sidebar-icon {
            width: 24px;
            height: 24px;
        }
        .story-ring {
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
        }
    </style>
</head>
<body class="bg-black">

    <div class="flex">
        <nav class="fixed h-screen w-[72px] xl:w-[250px] border-r border-zinc-800 px-1 py-1 flex flex-col items-start transition-all duration-300" id="mainNav">
            <div class="py-4 mb-4 mt-2 flex justify-center">
                <img src="{% static 'myapp/img/instagram.png' %}" alt="instagram" class="w-6 h-6 hidden ml-5" id="logoIcon">
                <span class="logo-font text-5xl text-white hidden xl:inline mx-4" id="logoText">Instapp</span>
            </div>
            
            <a href="{% url 'inicio' %}" class="flex w-[98%] items-center gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2 mt-3">
                <svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M9.005 16.545a2.997 2.997 0 012.997-2.997h0A2.997 2.997 0 0115 16.545V22h7V11.543L12 2 2 11.543V22h7.005z"/></svg>
                <span class="hidden xl:inline ml-2 font-bold">Inicio</span>
            </a>

                <button onclick="toggleSearch()" class="flex w-[98%] gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2 mt-3 focus:font-bold">
                <img src="{% static 'myapp/img/busqueda.png' %}" alt="busqueda" class="w-7 h-7">
                    <span class="hidden xl:inline ml-1">Buscar</span>
                </button>

                <div id="searchPanel" class="hidden absolute left-16 w-96 bg-neutral-800 rounded-xl shadow-xl mt-2 ml-2 z-50">
                    <div class="p-4">
                        <div class="flex items-center gap-3 pb-3 border-b border-neutral-700">
                            <svg class="w-4 h-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                            </svg>
                            <input type="text"
                                id="searchInput"
                                class="w-full bg-transparent text-white placeholder-neutral-400 focus:outline-none text-sm"
                                placeholder="Buscar">
                        </div>
                    </div>
                    <div id="searchResults" class="max-h-[400px] overflow-y-auto">

                    </div>
                    <div id="loadingIndicator" class="hidden p-4 text-center text-neutral-400">
                        <span>Buscando...</span>
                    </div>
                </div>

            <a href="#" class="flex w-[98%] gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2 mt-3">
                <img src="{% static 'myapp/img/explorar.png' %}" alt="busqueda" class="w-7 h-7">
                <span class="hidden xl:inline ml-1">Explorar</span>
            </a>

            <a href="{% url 'reels_feed' %}" class="flex  w-[98%] gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2 mt-3">
                <img src="{% static 'myapp/img/reels.png' %}" alt="busqueda" class="w-7 h-7">
                <span class="hidden xl:inline ml-1">Reels</span>
            </a>

            <a href="{% url 'mensajes' %}" class="flex w-[98%] gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2 mt-3">
                <img src="{% static 'myapp/img/mensajes.png' %}" alt="busqueda" class="w-7 h-7">
                <span class="hidden xl:inline ml-1">Mensajes</span>
            </a>

            <a href="#" class="flex w-[98%] items-center gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2 mt-3">
                <svg class="sidebar-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M16.792 3.904A4.989 4.989 0 0121.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 014.708-5.218 4.21 4.21 0 013.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 013.679-1.938m0-2a6.04 6.04 0 00-4.797 2.127 6.052 6.052 0 00-4.787-2.127A6.985 6.985 0 00.5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 003.518 3.018 2 2 0 002.174 0 45.263 45.263 0 003.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 00-6.708-7.218z"/></svg>
                <span class="hidden xl:inline ml-2">Notificaciones</span>
            </a>
            <div class="w-[240px] relative inline-block text-left">

                <button onclick="toggleMenu()" class="flex w-[98%] items-center gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2 mt-3">
                    <img src="{% static 'myapp/img/mas.png' %}" alt="busqueda" class="w-6 h-6">
                <span class="hidden xl:inline ml-2">Crear</span>
                </button>


                <div id="dropdownMenu" class="hidden absolute w-full origin-top-right rounded-md bg-neutral-800 text-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none">
                    <button id="abrirModal" class="flex w-[98%] items-center gap-2 px-4 py-4 rounded-md hover:bg-neutral-700">Publicaci贸n
                    <img src="{% static 'myapp/img/camara.png' %}" alt="publi" class="w-8 h-8 ml-[45%]">
                    </button>
                    <button onclick="abrirModalHistoria()" class="flex items-center gap-2 px-4 py-4 rounded-md hover:bg-neutral-700">
                        Historia
                        <img src="{% static 'myapp/img/historia.png' %}" alt="historia" class="w-6 h-6 ml-[60%]">
                    </button>
                    <button id="abrirReel" class="flex items-center gap-2 px-4 py-4 rounded-md hover:bg-neutral-700">
                        Subir Reel
                        <img src="{% static 'myapp/img/reels.png' %}" alt="anuncio" class="w-6 h-6 ml-[58%]">
                    </button>

                    <a href="#" class="flex items-center gap-2 px-4 py-4 rounded-md hover:bg-neutral-700">
                    IA
                    <img src="{% static 'myapp/img/ai.png' %}" alt="ai" class="w-6 h-6 ml-[80%]">
                    </a>
                </div>
            </div>
            <a href="{% url 'perfil' user.username %}" class="flex w-[98%] items-center gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mt-3 ml-1">
                        {% if user.imagen_perfil %}
                            <img src="{{ user.imagen_perfil.url }}" alt="Foto de perfil" class="w-8 h-8 object-cover rounded-full border-2 border-white-500">
                        {% else %}
                            <img src="{% static 'myapp/img/perfil_default.jpg' %}" alt="Sin imagen" class="w-7 h-7 object-cover">
                    {% endif %}
                <span class="hidden xl:inline ml-1">Perfil</span>
            </a>

            <div class="fixed bottom-0 pb-4">
    <a href="https://www.meta.ai/" class="flex w-[98%] items-center gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2">
        <img src="{% static 'myapp/img/ai.png' %}" alt="ai" class="w-6 h-6">
        <span class="hidden xl:inline ml-2">Meta AI</span>
    </a>

    <div class="w-[240px] relative inline-block text-left">
        <button onclick="Menumas()" class="flex w-[98%] items-center gap-4 px-3 py-3 rounded-lg hover:bg-zinc-800 mx-2 mt-3">
            <img src="{% static 'myapp/img/menu.png' %}" alt="busqueda" class="w-6 h-6">
            <span class="hidden xl:inline ml-2">M谩s</span>
        </button>
        
        <div id="MasMenu" class="hidden absolute bottom-full w-full origin-bottom-left rounded-md bg-neutral-800 text-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none mb-2">
            <a href="{% url 'editar_perfil' %}" class="flex w-full items-center gap-2 px-4 py-4 rounded-md hover:bg-neutral-700">Configuraci贸n
            <img src="{% static 'myapp/img/confi.png' %}" alt="publi" class="w-7 h-7 ml-[35%]">
            </a>
            <a href="#" class="flex items-center gap-2 px-4 py-2 rounded-md hover:bg-neutral-700 mb-2">
            Cambiar apariencia
            <img src="{% static 'myapp/img/apariencia.png' %}" alt="historia" class="w-7 h-7 ml-[48%]">
            </a>
            <div class="border-t-4 border-b-2 border-neutral-700 mb-2 py-2">
                <a href="#" class="flex items-center gap-2 px-4 py-4 rounded-md hover:bg-neutral-700">
                Cambiar cuenta
                <img src="{% static 'myapp/img/cambiar.png' %}" alt="anuncio" class="w-6 h-6 ml-[30%] rounded-full">
                </a>
            </div>
            <a href="{% url 'cerrarse' %}" class="flex items-center gap-2 px-4 py-4 rounded-md hover:bg-neutral-700">
            Salir
            <img src="{% static 'myapp/img/salir.png' %}" alt="ai" class="w-7 h-7 ml-[67%]">
            </a>
        </div>
    </div>
        </nav>


        <main class="flex-1 p-8">
    <div class="max-w-xl mx-auto space-y-6 mt-2">
        <div class="flex space-x-4 overflow-x-auto pb-4">
            <!-- Bot贸n de crear historia -->
            <div class="flex-shrink-0">
                <button onclick="abrirModalHistoria()" class="flex flex-col items-center">
                    <div class="relative bg-black rounded-full">
                        {% if user.imagen_perfil %}
                            <img src="{{ user.imagen_perfil.url }}" alt="Tu historia" class="w-[64px] h-[64px] rounded-full border-2 border-neutral-700 object-cover">
                        {% else %}
                            <img src="{% static 'img/default-profile.png' %}" alt="Tu historia" class="w-[64px] h-[64px] rounded-full border-2 border-neutral-700 object-cover">
                        {% endif %}
                        <div class="absolute bottom-0 right-0 bg-blue-500 rounded-full w-6 h-6 flex items-center justify-center text-white text-xl font-bold">+</div>
                    </div>
                    <span class="text-xs mt-1">Tu historia</span>
                </button>
            </div>

            <!-- Historias activas -->
            <div id="historias-container" class="flex space-x-4">
                {% for historia in historias_activas %}
                    <div class="flex-shrink-0 ">
                        <button onclick="verHistoria('{{ historia.id }}')" class="flex flex-col items-center">
                            <div class="story-ring p-[2px] rounded-full {% if historia.vista %}opacity-50{% endif %}">
                                <div class="bg-black p-[2px] rounded-full">
                                    {% if historia.autor.imagen_perfil %}
                                        <img src="{{ historia.autor.imagen_perfil.url }}" alt="{{ historia.autor.username }}" class="w-14 h-14 rounded-full object-cover">
                                    {% else %}
                                        <img src="{% static 'img/default-profile.png' %}" alt="{{ historia.autor.username }}" class="w-14 h-14 rounded-full object-cover">
                                    {% endif %}
                                </div>
                            </div>
                            <span class="text-xs mt-1">{{ historia.autor.username }}</span>
                        </button>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

            <div class="max-w-xl mx-auto space-y-6 mt-2">
                {% for publicacion in publicaciones %}
                    <div class="flex items-center gap-3">
                            {% if publicacion.autor.imagen_perfil %}
                                <img src="{{ publicacion.autor.imagen_perfil.url }}" alt="{{ publicacion.autor.username }}" class="w-10 h-10 rounded-full object-cover">
                            {% else %}
                                <img src="{% static 'myapp/img/perfil_default.jpg' %}" alt="{{ publicacion.autor.username }}" class="w-10 h-10 rounded-full object-cover">
                            {% endif %}
                            <span class="text-white">{{ a.username }}</span>

                        <span class="font-semibold">{{ publicacion.autor.username }}</span>
                        {% load customtime %}
                        <p class="text-xs text-gray-500 mt-1">Hace {{ publicacion.fecha_creacion|timesince_con_y }} </p>
                    </div>

                    <div class="relative overflow-hidden rounded-md bg-zinc-900 shadow-md w-[500px] h-[700px]" id="carousel-{{ forloop.counter }}">
                            {% for archivo in publicacion.archivos.all %}
                                <div class="bg-zinc-900 rounded-lg shadow-md overflow-hidden w-[500px] h-[700px]">
                                    {% if archivo.es_imagen %}
                                        <img src="{{ archivo.archivo.url }}" alt="Imagen" class="w-full h-full object-cover">
                                    {% elif archivo.es_video %}
                                    <div class="video-container bg-zinc-900 rounded-lg shadow-md overflow-hidden w-[500px] h-[700px]">
                                        <video class="video-player w-full h-full object-cover" src="{{ archivo.archivo.url }}"muted loop playsinline></video>
                                            <div class="controls">
                                            <button class="mute-toggle"></button>
                                            <input type="range" class="seek-bar" value="0">
                                            </div>
                                    </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    <div class="text-sm text-gray-300">
                        <p class="mt-2">{{ publicacion.descripcion }}</p>
                        <p class="text-xs text-gray-500 mt-1">{{ publicacion.fecha_creacion|date:"d M Y H:i" }}</p>
                    </div>
                        {% endfor %}
            </div>

        </main>
        <div class="hidden xl:block fixed right-10 top-24 w-72">
            <h2 class="text-white font-bold mb-4">Sugerencias para ti</h2>
            <div class="space-y-4">
                {% for sugerencia in usuarios_sugeridos %}
                    <div class="flex items-center gap-4">
                        {% if sugerencia.usuario.imagen_perfil %}
                            <img src="{{ sugerencia.usuario.imagen_perfil.url }}" alt="Avatar" class="w-10 h-10 rounded-full object-cover">
                        {% else %}
                            <img src="{% static 'myapp/img/perfil_default.jpg' %}" alt="Avatar" class="w-10 h-10 rounded-full object-cover">
                        {% endif %}
                        <div class="text-sm">
                            <p class="font-semibold">{{ sugerencia.usuario.username }}</p>
                            {% if sugerencia.conteo_seguidores_mutuos > 0 %}
                                <p class="text-xs text-gray-500">
                                    {% if sugerencia.conteo_seguidores_mutuos == 1 %}
                                        {{ sugerencia.seguidor_mutuo.username }} sigue a esta cuenta.
                                    {% else %}
                                        {{ sugerencia.seguidor_mutuo.username }} y {{ sugerencia.conteo_seguidores_mutuos|add:"-1" }} m谩s siguen esta cuenta.
                                    {% endif %}
                                </p>
                            {% endif %}

                        </div>
                        <a href="{% url 'seguir_usuario' sugerencia.usuario.username %}" class="ml-auto text-blue-500 text-sm">
                            {% if sugerencia.es_seguido_por_actual %}Dejar de seguir{% else %}Seguir{% endif %}
                        </a>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% include 'paginas/crear_publi.html' %}
    {% include 'paginas/subir_historia.html' %}
    {% include 'paginas/visor_historias.html' %}
        <!-- Modal (vac铆o al inicio) -->
    <div id="modalFormulario" class="fixed inset-0 bg-black/60 flex items-center justify-center hidden z-[9999]">
        <div id="contenidoModal" class="bg-neutral-800 rounded-lg shadow-lg w-[400px] p-4 relative">
            <!-- Aqu铆 se cargar谩 el formulario -->
        </div>
    </div>
    <script>
document.addEventListener('DOMContentLoaded', () => {
  const dropZone = document.getElementById('dropZonePublicacion');
  const inputFile = document.getElementById('file-upload');
  const uploadText = document.getElementById('uploadTextPublicacion');
  const preview = document.getElementById('previewPublicacion');
  const previewContainer = document.getElementById('preview-container');
  const cancelarModal = document.getElementById('cancelarModalPublicacion');
  const modal = document.getElementById('modalPublicacion');

  // Abrir modal (si tienes bot贸n)
  document.getElementById('abrirPublicacion')?.addEventListener('click', () => {
    modal.classList.remove('hidden');
  });

  cancelarModal.addEventListener('click', () => {
    modal.classList.add('hidden');
    resetPreview();
  });

  // Mostrar vista previa al seleccionar archivo
  inputFile.addEventListener('change', (e) => {
    const files = Array.from(e.target.files);

    if (files.length > 0) {
      // Limpiar vista previa
      previewContainer.innerHTML = '';
      uploadText.classList.add('hidden');
      preview.classList.remove('hidden');

      files.forEach(file => {
        const url = URL.createObjectURL(file);

        let elementoPreview;
        if (file.type.startsWith('video/')) {
          elementoPreview = `<video src="${url}" class="w-full h-full object-cover rounded-lg" autoplay loop muted></video>`;
        } else {
          elementoPreview = `<img src="${url}" class="w-full h-full object-cover rounded-lg">`;
        }

        // Hacer que ocupe todo el dropzone
        previewContainer.innerHTML = `
          <div class="w-full h-full">${elementoPreview}</div>
        `;
      });
    } else {
      resetPreview();
    }
  });

  // Drag & Drop
  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('border-blue-500');
  });

  dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('border-blue-500');
  });

  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('border-blue-500');
    inputFile.files = e.dataTransfer.files;
    inputFile.dispatchEvent(new Event('change'));
  });

  // Funci贸n para resetear el preview
  function resetPreview() {
    preview.classList.add('hidden');
    uploadText.classList.remove('hidden');
    previewContainer.innerHTML = '';
    inputFile.value = '';
  }
});

    </script>
    <script src="{% static 'myapp/js/inicio.js' %}" ></script>
</body>
</html>

